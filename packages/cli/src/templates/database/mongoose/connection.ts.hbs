import mongoose from "mongoose";

/**
 * MongoDB connection configuration
 */
const MONGODB_URI = process.env.MONGODB_URI || "mongodb://localhost:27017/{{name}}";

/**
 * Connect to MongoDB using Mongoose
 * @returns Promise that resolves when connected
 */
export async function connectToDatabase(): Promise<void> {
  try {
    if (mongoose.connection.readyState === 0) {
      await mongoose.connect(MONGODB_URI);
      console.log("‚úÖ Connected to MongoDB");
    }
  } catch (error) {
    console.error("‚ùå MongoDB connection error:", error);
    process.exit(1);
  }
}

/**
 * Disconnect from MongoDB
 * @returns Promise that resolves when disconnected
 */
export async function disconnectFromDatabase(): Promise<void> {
  try {
    await mongoose.disconnect();
    console.log("‚úÖ Disconnected from MongoDB");
  } catch (error) {
    console.error("‚ùå MongoDB disconnection error:", error);
  }
}

/**
 * Handle MongoDB connection events
 */
mongoose.connection.on("connected", () => {
  console.log("üì° Mongoose connected to MongoDB");
});

mongoose.connection.on("error", (error) => {
  console.error("‚ùå Mongoose connection error:", error);
});

mongoose.connection.on("disconnected", () => {
  console.log("üì° Mongoose disconnected from MongoDB");
});

/**
 * Graceful shutdown
 */
process.on("SIGINT", async () => {
  await disconnectFromDatabase();
  process.exit(0);
});