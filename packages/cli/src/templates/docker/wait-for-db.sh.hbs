#!/bin/bash

# Wait for database to be ready
echo "ğŸ”„ Waiting for database to be ready..."

{{#if (eq database "postgres")}}
# PostgreSQL health check
until docker exec {{name}}-postgres pg_isready -U {{dbUser}} > /dev/null 2>&1; do
  echo "â³ PostgreSQL is unavailable - sleeping..."
  sleep 2
done
echo "âœ… PostgreSQL is ready!"
{{else if (eq database "mysql")}}
# MySQL health check  
until docker exec {{name}}-mysql mysqladmin ping -h"localhost" --silent > /dev/null 2>&1; do
  echo "â³ MySQL is unavailable - sleeping..."
  sleep 2
done
echo "âœ… MySQL is ready!"
{{else if (eq database "mongodb")}}
# MongoDB health check
until docker exec {{name}}-mongodb mongosh --eval "db.adminCommand('ping')" > /dev/null 2>&1; do
  echo "â³ MongoDB is unavailable - sleeping..."
  sleep 2
done
echo "âœ… MongoDB is ready!"
{{/if}}

{{#if includeRedis}}
# Redis health check
until docker exec {{name}}-redis redis-cli ping > /dev/null 2>&1; do
  echo "â³ Redis is unavailable - sleeping..."
  sleep 2
done
echo "âœ… Redis is ready!"
{{/if}}

echo "ğŸš€ All services are ready!"